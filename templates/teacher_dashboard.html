{% extends "base.html" %}
{% block title %}å…ˆç”Ÿã‚¢ã‚«ã‚¦ãƒ³ãƒˆ{% endblock %}
{% block content %}
<h2>å…ˆç”Ÿã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h2>

<h3>æœ¬æ—¥åˆ†ã®æå‡º</h3>
<p>å¯¾è±¡æ—¥ï¼š{{ tdate }}</p>
<ul>
  {% for e in entries_today %}
    <li>
      {# æ°åã‚¯ãƒªãƒƒã‚¯ã§ãã®ç”Ÿå¾’ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¸ï¼ˆqãŒã‚ã‚Œã°å¼•ãç¶™ãï¼‰ #}
      <a href="?sid={{ e.student_id }}{% if request.GET.q %}&q={{ request.GET.q|urlencode }}{% endif %}#history-section">
        {% if e.student.user.last_name or e.student.user.first_name %}
          {{ e.student.user.last_name }}{{ e.student.user.first_name }}
        {% else %}
          {{ e.student.user.username }}
        {% endif %}
      </a>
      ï¼ˆ{{ e.student.class_room.grade.name|default:"" }}{{ e.student.class_room.name|default:"" }}ï¼‰
      <span class="meta">
        <span style="display:inline-block;padding:2px 8px;border-radius:999px;background:#eef7ff;color:#134f84;font-size:12px;">
          ä½“èª¿ï¼š{{ e.get_condition_display }}
        </span>
        <span style="display:inline-block;padding:2px 8px;border-radius:999px;background:#f7f2ff;color:#4a2a85;font-size:12px;margin-left:6px;">
          ãƒ¡ãƒ³ã‚¿ãƒ«ï¼š{{ e.get_mental_display }}
        </span>
      </span>
      é€£çµ¡å†…å®¹ï¼š{{ e.content|default:"(å†…å®¹ãªã—)" }}
      {% if e.is_read %}
        <span class="liked">
          ğŸ‘ ã„ã„ã­æ¸ˆã¿ï¼ˆ
          {% if e.read_by.last_name or e.read_by.first_name %}
            {{ e.read_by.last_name }}{{ e.read_by.first_name }}
          {% else %}
            {{ e.read_by.username }}
          {% endif %}
          / {{ e.read_at|date:"Y-m-d H:i" }}ï¼‰
        </span>
      {% else %}
        <form method="post" action="{% url 'mark_read' e.id %}" style="display:inline;">
          {% csrf_token %}
          <button class="btn" type="submit">&#128077; ã„ã„ã­</button>
        </form>
      {% endif %}
    </li>
  {% empty %}
    <li>ã¾ã æå‡ºã¯ã‚ã‚Šã¾ã›ã‚“</li>
  {% endfor %}
</ul>

<h3>æœªæå‡º</h3>
<ul>
  {% for s in not_submitted %}
    <li>
      <a href="?sid={{ s.id }}{% if request.GET.q %}&q={{ request.GET.q|urlencode }}{% endif %}#history-section">
        {% if s.user.last_name or s.user.first_name %}
          {{ s.user.last_name }}{{ s.user.first_name }}
        {% else %}
          {{ s.user.username }}
        {% endif %}
      </a>
      ï¼ˆ{{ s.class_room.grade.name }}{{ s.class_room.name }}ï¼‰
    </li>
  {% empty %}
    <li>æœªæå‡ºè€…ã¯ã„ã¾ã›ã‚“</li>
  {% endfor %}
</ul>

<h3 id="history-section">å±¥æ­´ï¼ˆæœ€æ–°200ä»¶ï¼‰</h3>

{# æ¤œç´¢çµæœè¡¨ç¤ºä¸­ã®ã¿ã€Œå…¨å±¥æ­´è¡¨ç¤ºã«æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºæ™‚ã¯åˆ¥é€”è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰ #}
{% if request.GET.q and not request.GET.sid %}
  <p>
    <a class="btn" href="{% url 'teacher_dashboard' %}#history-section">å…¨å±¥æ­´è¡¨ç¤ºã«æˆ»ã‚‹</a>
  </p>
{% endif %}

{# ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸­ã¯ãƒãƒƒã‚¸ã¨ã€Œå…¨å±¥æ­´è¡¨ç¤ºã«æˆ»ã‚‹ã€ãƒªãƒ³ã‚¯ #}
{% if selected_student %}
 <p>è¡¨ç¤ºä¸­ï¼š
    {% if selected_student.user.last_name or selected_student.user.first_name %}
      {{ selected_student.user.last_name }}{{ selected_student.user.first_name }}
    {% else %}
      {{ selected_student.user.username }}
    {% endif %}ã•ã‚“ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆç›´è¿‘200ä»¶ï¼‰
    <a class="btn" href="{% url 'teacher_dashboard' %}#history-section">å…¨å±¥æ­´è¡¨ç¤ºã«æˆ»ã‚‹</a>
  </p>
{% endif %}

<form method="get">
  <!-- æ—¥ä»˜ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ»æ°åãƒ»å†…å®¹ã§çµã‚Šè¾¼ã¿æ¤œç´¢å¯ï¼ˆqã‚’viewsã«æ¸¡ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿å‡¦ç†ï¼‰ -->
  <input name="q" value="{{ request.GET.q }}" placeholder="ç”Ÿå¾’å/å†…å®¹ã§æ¤œç´¢">
  {# ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿ã£ã¦æ¤œç´¢ã™ã‚‹ç”¨ã® hidden #}
  {% if request.GET.sid %}<input type="hidden" name="sid" value="{{ request.GET.sid }}">{% endif %}
  <button class="btn" type="submit">æ¤œç´¢</button>
</form>

<ul>
  {% for h in history %}
    <li>
      {{ h.target_date }} -
      <a href="?sid={{ h.student_id }}{% if request.GET.q %}&q={{ request.GET.q|urlencode }}{% endif %}#history-section">
        {% if h.student.user.last_name or h.student.user.first_name %}
          {{ h.student.user.last_name }}{{ h.student.user.first_name }}
        {% else %}
          {{ h.student.user.username }}
        {% endif %}
      </a>
      ï¼ˆ{{ h.student.class_room.grade.name|default:"" }}{{ h.student.class_room.name|default:"" }}ï¼‰
      <span class="meta">
        <span style="display:inline-block;padding:2px 8px;border-radius:999px;background:#eef7ff;color:#134f84;font-size:12px;">
          ä½“èª¿ï¼š{{ h.get_condition_display }}
        </span>
        <span style="display:inline-block;padding:2px 8px;border-radius:999px;background:#f7f2ff;color:#4a2a85;font-size:12px;margin-left:6px;">
          ãƒ¡ãƒ³ã‚¿ãƒ«ï¼š{{ h.get_mental_display }}
        </span>
      </span>
      é€£çµ¡å†…å®¹ï¼š{{ h.content|truncatechars:40 }}
      {% if h.is_read %}
        <span class="liked">
          ğŸ‘ ã„ã„ã­æ¸ˆã¿ï¼ˆ
          {% if h.read_by.last_name or h.read_by.first_name %}
            {{ h.read_by.last_name }}{{ h.read_by.first_name }}
          {% else %}
            {{ h.read_by.username }}
          {% endif %}
          / {{ h.read_at|date:"Y-m-d H:i" }}ï¼‰
        </span>
      {% else %}
        <form method="post" action="{% url 'mark_read' h.id %}" style="display:inline;">
          {% csrf_token %}
          {# æˆ»ã‚Šå…ˆï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚„æ¤œç´¢æ¡ä»¶ã‚’ç¶­æŒã—ã¦å±¥æ­´è¦‹å‡ºã—ã¸ï¼‰ #}
          <input type="hidden" name="next"
            value="{% url 'teacher_dashboard' %}{% if request.GET.sid or request.GET.q %}?{% endif %}
                  {% if request.GET.sid %}sid={{ request.GET.sid }}{% endif %}
                  {% if request.GET.sid and request.GET.q %}&{% endif %}
                  {% if request.GET.q %}q={{ request.GET.q|urlencode }}{% endif %}#history-section">
          <button class="btn" type="submit">&#128077; ã„ã„ã­</button>
        </form>
      {% endif %}
    </li>
  {% empty %}
    <li>å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</li>
  {% endfor %}
</ul>
{% endblock %}